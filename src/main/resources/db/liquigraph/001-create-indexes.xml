<?xml version="1.0" encoding="UTF-8"?>
<changelog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:noNamespaceSchemaLocation="https://www.liquigraph.org/schema/1.0/liquigraph.xsd">

    <!-- Constraints/Ã­ndices -->
    <changeset id="v1-constraints" author="jota">
        <query>
            <![CDATA[
              CREATE CONSTRAINT domain_key_unique IF NOT EXISTS
              FOR (d:Domain) REQUIRE (d.tenantId, d.key) IS UNIQUE;
              CREATE CONSTRAINT subdomain_key_unique IF NOT EXISTS
              FOR (s:SubDomain) REQUIRE (s.tenantId, s.key) IS UNIQUE;
              CREATE CONSTRAINT capability_key_unique IF NOT EXISTS
              FOR (c:Capability) REQUIRE (c.tenantId, c.key) IS UNIQUE;
            ]]>
        </query>
    </changeset>

    <!-- Seeds de DEV (opcional) -->
    <changeset id="v1-seed-dev" author="jota" runOnChange="false" runAlways="false">
        <query>
            <![CDATA[
              MERGE (d:Domain {tenantId:'vivo', key:'finance'}) SET d.name='Finance';
              MERGE (sd:SubDomain {tenantId:'vivo', key:'billing'}) SET sd.name='Billing';
              MERGE (sd)-[:BELONGS_TO]->(d);
              MERGE (cap:Capability {tenantId:'vivo', key:'invoicing'}) SET cap.name='Invoicing';
              MERGE (cap)-[:RELATES_TO_SUBDOMAIN]->(sd);
            ]]>
        </query>
    </changeset>

</changelog>